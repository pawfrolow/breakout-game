var k=Object.defineProperty;var M=(c,d,l)=>d in c?k(c,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[d]=l;var i=(c,d,l)=>(M(c,typeof d!="symbol"?d+"":d,l),l);(function(){"use strict";class c{constructor(h){i(this,"_x",0);i(this,"_y",0);i(this,"width",0);i(this,"height",0);i(this,"canvas");i(this,"ctx");i(this,"sides",{top:0,right:0,bottom:0,left:0});i(this,"getCenterCanvas",()=>({x:Math.round(this.canvas.width/2),y:Math.round(this.canvas.height/2)}));this.canvas=h,this.ctx=this.canvas.getContext("2d")}get x(){return this._x}set x(h){this._x=h,this.setSides({x:h,y:this._y})}get y(){return this._y}set y(h){this._y=h,this.setSides({y:h,x:this._x})}}const d=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",l={background:{dark:"#132A13",light:"#ECF39E"},platform:{dark:"#31572C",light:"#31572C"},ball:{dark:"#ECF39E",light:"#4F772D"},brick:{dark:"#31572C",light:"#31572C"}},u=d(),p={common:{theme:u},platform:{widthRatio:4,widthToHeightRatio:12,color:l.platform[u]},brick:{widthRatio:8,widthToHeightRatio:4,color:l.brick[u]},ball:{widthRatio:6,widthToHeightRatio:12,color:l.ball[u],speed:1,dx:5,dy:3},background:{color:l.background[u]},player:{name:"Player",lives:5,score:0,level:1}},n=Object.freeze(p);var r=(a=>(a.top="top",a.right="right",a.bottom="bottom",a.left="left",a))(r||{}),f=(a=>(a.horizontal="horizontal",a.vertical="vertical",a))(f||{});class w extends c{constructor(t){super(t);i(this,"radius",0);i(this,"isMoving",!1);i(this,"speed",n.ball.speed);i(this,"dx",n.ball.dx);i(this,"dy",n.ball.dy);i(this,"direction",{x:r.right,y:r.top});i(this,"init",()=>{const{width:t,height:s}=this.getSize();this.width=t,this.height=s,this.radius=this.getBallRadius();const{x:e,y:o}=this.getInitialPosition();this.x=e,this.y=o,this.setSides({x:e,y:o}),this.direction={x:r.right,y:r.top},this.isMoving=!1});i(this,"draw",()=>{const{x:t,y:s,radius:e}=this;this.ctx.fillStyle=n.ball.color,this.ctx.beginPath(),this.ctx.arc(t,s,e,0,2*Math.PI,!1),this.ctx.fill()});i(this,"move",()=>{this.direction.x===r.left&&(this.x-=this.dx*this.speed),this.direction.x===r.right&&(this.x+=this.dx*this.speed),this.direction.y===r.bottom&&(this.y+=this.dy*this.speed),this.direction.y===r.top&&(this.y-=this.dy*this.speed)});i(this,"getInitialPosition",()=>{const t=this.getCenterCanvas().x,s=Math.round(this.canvas.width/n.platform.widthRatio),e=Math.round(s/n.platform.widthToHeightRatio),o=this.canvas.height-e-this.radius;return{x:t,y:o}});i(this,"setSides",({x:t,y:s})=>{this.sides={top:s-this.radius,right:t+this.radius,bottom:s+this.radius,left:t-this.radius}});i(this,"getBallRadius",()=>Math.round(this.width/2));i(this,"switchDirectionBySide",t=>{t===r.right&&(this.direction.x=r.left),t===r.left&&(this.direction.x=r.right),t===r.top&&(this.direction.y=r.bottom)});i(this,"getReachedWall",()=>this.sides.right>=this.canvas.width?r.right:this.sides.left<=0?r.left:this.sides.top<=0?r.top:this.sides.bottom>=this.canvas.height?r.bottom:null);i(this,"switchDirection",t=>{t===f.horizontal&&(this.direction.x=this.direction.x===r.left?r.right:r.left),t===f.vertical&&(this.direction.y=this.direction.y===r.top?r.bottom:r.top)});this.init()}getSize(){const t=Math.round(this.canvas.width/n.ball.widthRatio),s=Math.round(t/n.ball.widthToHeightRatio);return{height:s,width:s}}}class m extends c{constructor(t,s){super(t);i(this,"isShowed",!0);i(this,"count");i(this,"row");i(this,"col");i(this,"init",()=>{const{width:t,height:s}=this.getSize();this.width=t,this.height=s;const{x:e,y:o}=this.getInitialPosition();this.x=e,this.y=o});i(this,"draw",()=>{if(this.isShowed){const{x:t,y:s,width:e,height:o}=this;this.ctx.fillStyle=n.brick.color,this.ctx.fillRect(t,s,e,o)}});i(this,"getInitialPosition",()=>{const t=Math.round(this.canvas.width/(this.count+1)/5);return{x:t+this.col*(this.width+t),y:t+this.row*(this.height+t)}});i(this,"setSides",({x:t,y:s})=>{this.sides={top:s,right:t+this.width,bottom:s+this.height,left:t}});i(this,"checkBallCollision",t=>{if(this.isShowed){const s=Math.abs(t.x-this.x-this.width/2),e=Math.abs(t.y-this.y-this.height/2);if(s>this.width/2+t.radius||e>this.height/2+t.radius)return null;if(s<=this.width/2)return f.vertical;if(e<=this.height/2)return f.horizontal}return null});const{count:e,row:o,col:g}=s;this.count=e,this.row=o,this.col=g,this.init()}getSize(){const t=Math.round(this.canvas.width/(this.count+1)/5),s=Math.round((this.canvas.width-t*(this.count+1))/this.count),e=Math.round(s/n.brick.widthToHeightRatio);return{width:s,height:e}}}class b{constructor(h,t){i(this,"canvas");i(this,"ctx");i(this,"bricks",[]);i(this,"level");i(this,"init",()=>{this.bricks=[],this.level.matrix.forEach((h,t)=>{this.bricks.push([]),h.forEach((s,e)=>{if(s){const o={count:Math.max(...this.level.matrix.map(g=>g.length)),row:t,col:e};this.bricks[t].push(new m(this.canvas,o))}})})});i(this,"draw",()=>{this.bricks.forEach(h=>{h.forEach(t=>t.draw())})});i(this,"checkBallCollision",h=>{for(let t=0;t<this.bricks.length;t++)for(let s=0;s<this.bricks[t].length;s++){const e=this.bricks[t][s],o=e.checkBallCollision(h);if(o)return e.isShowed=!1,o}return null});this.canvas=h,this.ctx=this.canvas.getContext("2d"),this.level=t,this.init()}get isAllBricksHidden(){return this.bricks.every(h=>h.every(t=>!t.isShowed))}}class v extends c{constructor(t){super(t);i(this,"speed",0);i(this,"lastUpdateTime",0);i(this,"lastX",0);i(this,"init",()=>{const{width:t,height:s}=this.getSize();this.width=t,this.height=s;const{x:e,y:o}=this.getInitialPosition();this.x=e,this.y=o,this.setSides({x:e,y:o})});i(this,"draw",()=>{const{x:t,y:s,width:e,height:o}=this;this.ctx.fillStyle=n.platform.color,this.ctx.fillRect(t,s,e,o)});i(this,"moveButton",t=>{const s=this.getPlatformMoveOffset();t==="left"&&this.x>0&&(this.x-=s),t==="right"&&this.sides.right<this.canvas.width&&(this.x+=s)});i(this,"moveMouse",t=>{let s=t;const e=Math.round(this.width/2),o=this.canvas.width-e;s>o&&(s=o),s<e&&(s=e),this.x=s-Math.round(this.width/2)});i(this,"getInitialPosition",()=>{const t=this.getCenterCanvas().x-Math.round(this.width/2),s=window.innerHeight-this.height;return{x:t,y:s}});i(this,"getPlatformMoveOffset",()=>Math.round(this.canvas.width/100));i(this,"setSides",({x:t,y:s})=>{this.sides={top:s,right:t+this.width,bottom:s+this.height,left:t}});i(this,"checkBallCollision",t=>{if(t.sides.bottom>this.sides.top){const s=Math.abs(t.x-this.x-this.width/2),e=Math.abs(t.y-this.y-this.height/2);if(s>this.width/2+t.radius||e>this.height/2+t.radius)return null;if(s<=this.width/2&&t.direction.y===r.bottom)return f.vertical;if(e<=this.height/2)return f.horizontal}return null});this.init(),setInterval(()=>this.updateSpeed(),100)}updateSpeed(){const t=Date.now();if(t-this.lastUpdateTime>=20){const s=this.x-this.lastX;this.speed=s/20,this.lastX=this.x,this.lastUpdateTime=t}}getSize(){const t=Math.round(this.canvas.width/n.platform.widthRatio),s=Math.round(t/n.platform.widthToHeightRatio);return{width:t,height:s}}}const x=[{matrix:[[!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0],[!1,!0,!0,!0]]}];class y{constructor(){i(this,"canvas");i(this,"ctx");i(this,"pressedBtn",null);i(this,"animationId",null);i(this,"bricks");i(this,"ball");i(this,"platform");i(this,"init",()=>{this.canvas.focus(),this.draw()});i(this,"draw",()=>{this.clearDraw(),this.fillBackground(),this.pressedBtn&&this.platform.moveButton(this.pressedBtn),this.ball.isMoving&&this.moveBall(),this.platform.draw(),this.ball.draw(),this.bricks.draw(),this.animationId=requestAnimationFrame(this.draw)});i(this,"clearDraw",()=>{this.stopAnimation(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)});i(this,"fillBackground",()=>{this.ctx.fillStyle=n.background.color,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)});i(this,"moveBall",()=>{const h=this.ball.getReachedWall();if(h===r.bottom||this.bricks.isAllBricksHidden){this.stopGame();return}h&&this.ball.switchDirectionBySide(h),this.checkBrickReached(),this.checkPlatformReached(),this.ball.move()});i(this,"checkPlatformReached",()=>{const h=this.platform.checkBallCollision(this.ball);if(h&&(this.ball.switchDirection(h),h===f.vertical)){const t=()=>{let s=Math.abs(this.platform.speed);return s<1&&s++,s>1.7?1.7:s};this.platform.speed<0&&this.ball.direction.x===r.left&&(this.ball.dx=n.ball.dx,this.ball.dy=2,this.ball.speed=t()),this.platform.speed>0&&this.ball.direction.x===r.right&&(this.ball.dx=n.ball.dx,this.ball.dy=2,this.ball.speed=t()),this.platform.speed<0&&this.ball.direction.x===r.right&&(this.ball.dy=n.ball.dy,this.ball.dx=2,this.ball.speed=1.5),this.platform.speed>0&&this.ball.direction.x===r.left&&(this.ball.dy=n.ball.dy,this.ball.dx=2,this.ball.speed=1.5),this.platform.speed===0&&(this.ball.dy=n.ball.dy,this.ball.dx=n.ball.dx,this.ball.speed=n.ball.speed)}});i(this,"checkBrickReached",()=>{const h=this.bricks.checkBallCollision(this.ball);h&&this.ball.switchDirection(h)});i(this,"resizeHandler",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.init()});i(this,"keyDownHandler",h=>{const t=h.key.toLowerCase().replace("arrow","");if(t==="left"||t==="right"){if(this.pressedBtn||!this.ball.isMoving)return;this.pressedBtn=t==="left"?r.left:r.right}t===" "&&(this.ball.isMoving=!0)});i(this,"keyUpHandler",()=>{this.pressedBtn=null});i(this,"mouseMoveHandler",h=>{this.ball.isMoving&&this.platform.moveMouse(h.x)});i(this,"stopAnimation",()=>{this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)});i(this,"stopGame",()=>{this.ball.init(),this.platform.init(),this.bricks.init(),this.draw()});i(this,"getCanvas",()=>document.querySelector("canvas"));this.canvas=this.getCanvas(),this.ctx=this.canvas.getContext("2d"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.ball=new w(this.canvas),this.platform=new v(this.canvas),this.bricks=new b(this.canvas,x[0]),window.addEventListener("resize",this.resizeHandler),window.addEventListener("keydown",this.keyDownHandler),window.addEventListener("keyup",this.keyUpHandler),window.addEventListener("mousemove",this.mouseMoveHandler),this.init()}}const B="";new y})();
